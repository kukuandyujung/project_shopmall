<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.java.mapper.ProductMapper">
<!-- 상품 전체 개수 검색하기 -->
   <select id="selectListCount" resultType="int">
      select count(*) from product
      <if test="category == 'all'">      
         where pname like '%'||#{s_word}||'%' or pdescript like '%'||#{s_word}||'%'
      </if>
      <if test="category == 'btitle'">      
         where pname like '%'||#{s_word}||'%' 
      </if>
      <if test="category == 'bcontent'">      
         where pname like '%'||#{s_word}||'%' 
      </if>
   </select>
   
   
<!-- 상품 전체 가져오기 -->
<select id="selectAll" resultType="com.java.dto.ProductDto">
   <!-- 공통 영역 -->
            select * from (select rownum rnum, a.* from
         (select * from product 
            
         <if test="category == 'all'">      
            where pname like '%'||#{s_word}||'%' or pdescript like '%'||#{s_word}||'%'
         </if>
         <if test="category == 'pname'">      
            where pname like '%'||#{s_word}||'%' 
         </if>
         <if test="category == 'pdescript'">      
            where pdescript like '%'||#{s_word}||'%' 
         </if>
         
      
         <!-- 공통 영역  -->
         <![CDATA[
         order by pno asc) a)
         where rnum>=#{startRow} and rnum<=#{endRow}
        ]]>

      
   </select>



   <!-- 상품 1개 가져오기 -->
   <select id="selectOne" resultType="com.java.dto.ProductDto">
      select * from product where pno=#{pno}
   </select>
   


   <!-- 상품 이전글  -->
   <select id="selectPreOne" resultType="com.java.dto.ProductDto">
      select * from product where pno=
     (select prevDto from
     (select pno,lead(pno,1,-1) over(order by pno asc) as prevDto
     from product order by pno asc) where pno=#{pno})
   </select>
   <!-- 상품 다음글  -->
   <select id="selectNextOne" resultType="com.java.dto.ProductDto"> 
      select * from product where pno=
     (select nextDto from
     (select pno,lag(pno,1,-1) over(order by pno asc) as nextDto
     from product order by  pno asc) where pno=#{pno})
   </select>
   
   <!-- 상품 조회수 1 증가 생각해보니 이거는 지금 할 수 없 ... ㅋ-->
   <update id="updatePhitUp">
      update product set phit= phit+1 where pno=#{pno}
   </update>
   
   <!-- 상품 1개 저장 -->
   <!-- 상품 테이블에 새로운 레코드를 삽입하기. 상품 등록 시 사용되는 변수를 적으면 된다. product_seq.nextval는 시퀀스로 부터 새로운 게시글의 고유 번호를 생성한다.   -->
   <insert id="insertOne">
   	<selectKey resultType="int" keyProperty="pno" order="BEFORE">
		select seq_product.nextval from dual
	</selectKey>
   insert into product (pno, pcode, pname, pprice, 
      pstock, psoldcount, pcolor, psize, 
      pdescript, pmainimg, pdetailimg1, pdetailimg2, pdetailimg3)
   values (#{pno}, #{pcode}, #{pname}, #{pprice},
      #{pstock}, #{psoldcount}, #{pcolor}, #{psize},
      #{pdescript}, #{pmainimg}, #{pdetailimg1}, #{pdetailimg2}, #{pdetailimg3})
</insert>
   
   <delete id="deleteOne">
      delete product where pno=#{pno}
   </delete>
   
   <!-- 상품 1개 수정  -->
   <!-- 주어집 값에 대해 업데이트하기 그냥 상품 리스트에 적힌 변수를 적고 업데이트 대상을 pno가 주어진 값과 일치하는 레코드이다. -->
   <update id="updateOne">
      update product set pcode =#{pcode}, pname=#{pname}, pprice=#{pprice},
      pstock=#{pstock},psoldcount=#{psoldcount},  pcolor=#{pcolor}, psize=#{psize},
      pdescript=#{pdescript},
      pmainimg=#{pmainimg},
      pdetailimg1=#{pdetailimg1},pdetailimg2=#{pdetailimg2}, pdetailimg3=#{pdetailimg3}
      where pno = #{pno}
   </update>
   <!--  
   <update id="updatePstepCount">
      update product set pstep=pstep+1 where pno=#{pno} and pstep=#{pstep}
   </update>
   -->

   <!-- ============================여기부터는 상품 페이지 ====================================== -->

    <!-- women 상품 페이지에서 상품 전체 가져오기 아무 옵션을 누르지 않을 경우--> 
   <select id="selectPageAll" resultType="com.java.dto.ProductDto">
      <!-- 공통 영역 -->
            select * from (select rownum rnum, a.* from
         (select * from product 
   
         <if test="category == 'all'">      
            where pname like '%'||#{s_word}||'%' or pdescript like '%'||#{s_word}||'%' order by pno asc
            
         </if>
         <if test="category == 'pname'">      
            where pname like '%'||#{s_word}||'%' order by pno asc
            
         </if>
         <if test="category == 'pdescript'">      
            where pdescript like '%'||#{s_word}||'%' order by pno asc
         
         </if>
       
   
         
         <!-- 공통 영역  -->
         <![CDATA[
         where pcode=10 order by pno asc) a) 
          where rnum>=#{startRow} and rnum<=#{endRow} 
        ]]> 

    </select>
    
    <!-- home 상품 페이지에서 상품 전체 가져오기 아무 옵션을 누르지 않을 경우--> 
	<select id="selectHomeAll" resultType="com.java.dto.ProductDto">
   	<!-- 공통 영역 -->
        select * from (select rownum rnum, a.* from
         (select * from product 
   
         <if test="category == 'all'">      
            where pname like '%'||#{s_word}||'%' or pdescript like '%'||#{s_word}||'%' order by pno asc
            
         </if>
         <if test="category == 'pname'">      
            where pname like '%'||#{s_word}||'%' order by pno asc
            
         </if>
         <if test="category == 'pdescript'">      
            where pdescript like '%'||#{s_word}||'%' order by pno asc
         
         </if>
       
   
         
         <!-- 공통 영역  -->
         <![CDATA[
         where pcode=11 order by pno asc) a) 
          where rnum>=#{startRow} and rnum<=#{endRow} 
        ]]> 

    </select>
  
    
    <!-- 상세 페이지에서 상품 1개 가져오기 -->
    <!-- 상품 1개 가져오기 -->
   <select id="selectPageOne" resultType="com.java.dto.ProductDto">
      select * from product where pno=#{pno}
   </select>
   
   
    
    <!-- 상품 페이지에서 ajax 검색하기 -->
    <select id="selectSortAll" resultType="com.java.dto.ProductDto" >
       
		select * from product where pcode=10
		
         <if test="s_word">     
            and upper(pname) like upper('%'||#{s_word}||'%')
         
         </if>
		
		<if test="pcolor == 'black'">     
            and pcolor='black' 
        </if>	
		<if test="pcolor == 'pink'">      
            and pcolor='pink' 
         </if>
         <if test="pcolor == 'orange'">      
            and pcolor='orange'
         
         </if>
		 <if test="pcolor == 'yellow'">     
            and pcolor='yellow'
         
         </if>
         <if test="pcolor == 'white'">     
            and pcolor='white'
         
         </if>
         
		<if test="sorting == 'rowprice'">
		 	order by pprice asc 
		</if>
		<if test="sorting == 'highprice'">
			order by pprice desc 
		</if>
		


 
   
    </select>
    
</mapper>

